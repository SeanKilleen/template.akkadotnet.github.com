---
layout: default
---

      <p>An Akka <code>MessageDispatcher</code> is what makes Akka Actors "tick", it is the engine of the machine so to speak. All <code>MessageDispatcher</code> implementations are also an <code>ExecutionContext</code>, which means that they can be used to execute arbitrary code, for instance <code>Futures</code>.</p>

<h2>
<a name="user-content-default-dispatcher" class="anchor" href="#default-dispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Default dispatcher</h2>

<p>Every <code>ActorSystem</code> will have a default dispatcher that will be used in case nothing else is configured for an Actor. The default dispatcher can be configured using <code>akka.actor.default-dispatcher</code>, and is by default a <code>Dispatcher</code>.</p>

<h4>
<a name="user-content-actors-multiplexing-on-net-thread-pool" class="anchor" href="#actors-multiplexing-on-net-thread-pool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Actors multiplexing on .NET thread pool</h4>

<p><img src="/wiki/images/ThreadMultiplex.png"></p>

<h2>
<a name="user-content-looking-up-a-dispatcher" class="anchor" href="#looking-up-a-dispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Looking up a Dispatcher</h2>

<p>Dispatchers implement the ExecutionContext interface and can thus be used to run Future invocations etc.</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// this is scala.concurrent.ExecutionContext</span>
<span class="c1">// for use with Futures, Scheduler, etc.</span>
<span class="n">ExecutionContext</span> <span class="n">ex</span> <span class="p">=</span> <span class="n">system</span><span class="p">.</span><span class="n">Dispatchers</span><span class="p">.</span><span class="n">Lookup</span><span class="p">(</span><span class="s">"my-dispatcher"</span><span class="p">);</span>
</pre></div>

<h2>
<a name="user-content-setting-the-dispatcher-for-an-actor" class="anchor" href="#setting-the-dispatcher-for-an-actor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting the dispatcher for an Actor</h2>

<p>So in case you want to give your Actor a different dispatcher than the default, you need to do two things, of which the first is is to configure the dispatcher:</p>

<pre><code>my-dispatcher {
  # Dispatcher is the name of the event-based dispatcher
  type = Dispatcher
  # What kind of ExecutionService to use
  executor = "fork-join-executor"
  # Configuration for the fork join pool
  fork-join-executor {
    # Min number of threads to cap factor-based parallelism number to
    parallelism-min = 2
    # Parallelism (threads) ... ceil(available processors * factor)
    parallelism-factor = 2.0
    # Max number of threads to cap factor-based parallelism number to
    parallelism-max = 10
  }
  # Throughput defines the maximum number of messages to be
  # processed per actor before the thread jumps to the next actor.
  # Set to 1 for as fair as possible.
  throughput = 100
}
</code></pre>

<p>And here's another example that uses the <code>"thread-pool-executor"</code>:</p>

<pre><code>my-thread-pool-dispatcher {
  # Dispatcher is the name of the event-based dispatcher
  type = Dispatcher
  # What kind of ExecutionService to use
  executor = "thread-pool-executor"
  # Configuration for the thread pool
  thread-pool-executor {
    # minimum number of threads to cap factor-based core number to
    core-pool-size-min = 2
    # No of core threads ... ceil(available processors * factor)
    core-pool-size-factor = 2.0
    # maximum number of threads to cap factor-based number to
    core-pool-size-max = 10
  }
  # Throughput defines the maximum number of messages to be
  # processed per actor before the thread jumps to the next actor.
  # Set to 1 for as fair as possible.
  throughput = 100
}
</code></pre>

<p>For more options, see the <code>default-dispatcher</code> section of the Configuration.</p>

<p>Then you create the actor as usual and define the dispatcher in the deployment configuration.</p>

<div class="highlight highlight-csharp"><pre><span class="n">ActorRef</span> <span class="n">myActor</span> <span class="p">=</span>
  <span class="n">system</span><span class="p">.</span><span class="n">ActorOf</span><span class="p">(</span><span class="n">Props</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyUntypedActor</span><span class="p">)),</span>
    <span class="s">"myactor"</span><span class="p">);</span>
</pre></div>

<pre><code>akka.actor.deployment {
  /myactor {
    dispatcher = my-dispatcher
  }
}
</code></pre>

<p>An alternative to the deployment configuration is to define the dispatcher in code. If you define the dispatcher in the deployment configuration then this value will be used instead of programmatically provided parameter.</p>

<div class="highlight highlight-csharp"><pre><span class="n">ActorRef</span> <span class="n">myActor</span> <span class="p">=</span>
  <span class="n">system</span><span class="p">.</span><span class="n">ActorOf</span><span class="p">(</span><span class="n">Props</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyUntypedActor</span><span class="p">)).</span><span class="n">WithDispatcher</span><span class="p">(</span><span class="s">"my-dispatcher"</span><span class="p">),</span>
    <span class="s">"myactor3"</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note</strong><br>
The dispatcher you specify in <code>WithDispatcher</code> and the dispatcher property in the deployment configuration is in fact a path into your configuration. So in this example it's a top-level section, but you could for instance put it as a sub-section, where you'd use periods to denote sub-sections, like this: "foo.bar.my-dispatcher"</p>
</blockquote>

<h2>
<a name="user-content-types-of-dispatchers" class="anchor" href="#types-of-dispatchers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Types of dispatchers</h2>

<p>There are 4 different types of message dispatchers:</p>

<ul class="task-list">
<li>
<p>Dispatcher</p>

<ul class="task-list">
<li>This is an event-based dispatcher that binds a set of Actors to a thread pool. It is the default dispatcher used if one is not specified.</li>
<li>Sharability: Unlimited</li>
<li>Mailboxes: Any, creates one per Actor</li>
<li>Use cases: Default dispatcher, Bulkheading</li>
</ul>
</li>
<li>
<p>PinnedDispatcher</p>

<ul class="task-list">
<li>This dispatcher dedicates a unique thread for each actor using it; i.e. each actor will have its own thread pool with only one thread in the pool.</li>
<li>Sharability: None</li>
<li>Mailboxes: Any, creates one per Actor</li>
<li>Use cases: Bulkheading</li>
</ul>
</li>
<li>
<p>CallingThreadDispatcher</p>

<ul class="task-list">
<li>This dispatcher runs invocations on the current thread only. This dispatcher does not create any new threads, but it can be used from different threads concurrently for the same actor. See CallingThreadDispatcher for details and restrictions.</li>
<li>Sharability: Unlimited</li>
<li>Mailboxes: Any, creates one per Actor per Thread (on demand)</li>
<li>Use cases: Testing</li>
<li>Driven by: The calling thread (duh)</li>
</ul>
</li>
</ul><h3>
<a name="user-content-more-dispatcher-configuration-examples" class="anchor" href="#more-dispatcher-configuration-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More dispatcher configuration examples</h3>

<p>Configuring a <code>PinnedDispatcher</code>:</p>

<pre><code>my-pinned-dispatcher {
  type = PinnedDispatcher
}
</code></pre>

<p>And then using it:</p>

<div class="highlight highlight-csharp"><pre><span class="n">ActorRef</span> <span class="n">myActor</span> <span class="p">=</span> <span class="n">system</span><span class="p">.</span><span class="n">ActorOf</span><span class="p">(</span><span class="n">Props</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyUntypedActor</span><span class="p">));</span>
    <span class="p">.</span><span class="n">WithDispatcher</span><span class="p">(</span><span class="s">"my-pinned-dispatcher"</span><span class="p">));</span>
</pre></div>

<p>Note that <code>thread-pool-executor</code> configuration as per the above <code>my-thread-pool-dispatcher</code> example is NOT applicable. This is because every actor will have its own thread pool when using <code>PinnedDispatcher</code>, and that pool will have only one thread.</p>

<p>Note that it's not guaranteed that the same thread is used over time, since the core pool timeout is used for <code>PinnedDispatcher</code> to keep resource usage down in case of idle actors. To use the same thread all the time you need to add <code>thread-pool-executor.allow-core-timeout=off</code> to the configuration of the <code>PinnedDispatcher</code>.</p>
    