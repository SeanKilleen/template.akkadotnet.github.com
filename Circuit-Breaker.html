
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--
         The FAKE - F# Make - A DSL for build tasks
    parameters will be replaced with the
         document title extracted from the <h1> element or
         file name, if there is no <h1> heading
       -->
    <title>
        Akka.NET
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Akka.NET">
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="https://github.com/akkadotnet/">github page</a></li>
            </ul>
            <h3 class="muted">Akka.NET</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
      <h1>
<a name="user-content-circuit-breaker" class="anchor" href="#circuit-breaker" aria-hidden="true"><span class="octicon octicon-link"></span></a>Circuit Breaker</h1>

<h2>
<a name="user-content-why-are-they-used" class="anchor" href="#why-are-they-used" aria-hidden="true"><span class="octicon octicon-link"></span></a>Why are they used?</h2>

<p>A circuit breaker is used to provide stability and prevent cascading failures in distributed
systems.  These should be used in conjunction with judicious timeouts at the interfaces between
remote systems to prevent the failure of a single component from bringing down all components.</p>

<p>As an example, we have a web application interacting with a remote third party web service.<br>
Let's say the third party has oversold their capacity and their database melts down under load.<br>
Assume that the database fails in such a way that it takes a very long time to hand back an
error to the third party web service.  This in turn makes calls fail after a long period of 
time.  Back to our web application, the users have noticed that their form submissions take
much longer seeming to hang.  Well the users do what they know to do which is use the refresh
button, adding more requests to their already running requests.  This eventually causes the 
failure of the web application due to resource exhaustion.  This will affect all users, even
those who are not using functionality dependent on this third party web service.</p>

<p>Introducing circuit breakers on the web service call would cause the requests to begin to 
fail-fast, letting the user know that something is wrong and that they need not refresh 
their request.  This also confines the failure behavior to only those users that are using
functionality dependent on the third party, other users are no longer affected as there is no
resource exhaustion.  Circuit breakers can also allow savvy developers to mark portions of
the site that use the functionality unavailable, or perhaps show some cached content as 
appropriate while the breaker is open.</p>

<p>The Akka library provides an implementation of a circuit breaker called 
<code>Akka.Pattern.CircuitBreaker</code> which has the behavior described below.</p>

<h2>
<a name="user-content-what-do-they-do" class="anchor" href="#what-do-they-do" aria-hidden="true"><span class="octicon octicon-link"></span></a>What do they do?</h2>

<ul class="task-list">
<li>During normal operation, a circuit breaker is in the <code>Closed</code> state:

<ul class="task-list">
<li>Exceptions or calls exceeding the configured <code>callTimeout</code> increment a failure counter</li>
<li>Successes reset the failure count to zero </li>
<li>When the failure counter reaches a <code>maxFailures</code> count, the breaker is tripped into <code>Open</code> state</li>
</ul>
</li>
<li>While in <code>Open</code> state:

<ul class="task-list">
<li>All calls fail-fast with a :class:<code>CircuitBreakerOpenException</code>
</li>
<li>After the configured <code>resetTimeout</code>, the circuit breaker enters a <code>Half-Open</code> state</li>
</ul>
</li>
<li>In <code>Half-Open</code> state:

<ul class="task-list">
<li>The first call attempted is allowed through without failing fast</li>
<li>All other calls fail-fast with an exception just as in <code>Open</code> state</li>
<li>If the first call succeeds, the breaker is reset back to <code>Closed</code> state</li>
<li>If the first call fails, the breaker is tripped again into the <code>Open</code> state for another full <code>resetTimeout</code>
</li>
</ul>
</li>
<li>State transition listeners: 

<ul class="task-list">
<li>Callbacks can be provided for every state entry via <code>onOpen</code>, <code>onClose</code>, and <code>onHalfOpen</code>
</li>
<li>These are executed in the :class:<code>ExecutionContext</code> provided. </li>
</ul>
</li>
</ul><p>.. image:: ../images/circuit-breaker-states.png</p>

<h2>
<a name="user-content-examples" class="anchor" href="#examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Examples</h2>

<h3>
<a name="user-content-initialization" class="anchor" href="#initialization" aria-hidden="true"><span class="octicon octicon-link"></span></a>Initialization</h3>

<p>Here's how a :class:<code>CircuitBreaker</code> would be configured for:</p>

<ul class="task-list">
<li>5 maximum failures</li>
<li>a call timeout of 10 seconds </li>
<li>a reset timeout of 1 minute</li>
</ul><h4>
<a name="user-content-f-api" class="anchor" href="#f-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>F# Api</h4>

<p>.. includecode:: code/docs/circuitbreaker/CircuitBreakerDocSpec.cs
   :include: imports1,circuit-breaker-initialization</p>

<h4>
<a name="user-content-c-api" class="anchor" href="#c-api" aria-hidden="true"><span class="octicon octicon-link"></span></a>C# Api</h4>

<p>.. includecode:: code/docs/circuitbreaker/DangerousJavaActor.fs
   :include: imports1,circuit-breaker-initialization</p>

<h3>
<a name="user-content-call-protection" class="anchor" href="#call-protection" aria-hidden="true"><span class="octicon octicon-link"></span></a>Call Protection</h3>

<p>Here's how the :class:<code>CircuitBreaker</code> would be used to protect an asynchronous
call as well as a synchronous one:</p>

<h4>
<a name="user-content-f-api-1" class="anchor" href="#f-api-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>F# Api</h4>

<p>.. includecode:: code/docs/circuitbreaker/CircuitBreakerDocSpec.scala
   :include: circuit-breaker-usage</p>

<h4>
<a name="user-content-c-api-1" class="anchor" href="#c-api-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>C# Api</h4>

<p>.. includecode:: code/docs/circuitbreaker/DangerousJavaActor.java
   :include: circuit-breaker-usage</p>

<blockquote>
<p><strong>Node</strong><br>
Using the :class:<code>CircuitBreaker</code> companion object's <code>apply</code> or <code>create</code> methods
will return a :class:<code>CircuitBreaker</code> where callbacks are executed in the caller's thread.
This can be useful if the asynchronous :class:<code>Future</code> behavior is unnecessary, for
example invoking a synchronous-only API.</p>
</blockquote>
    
            </div>
            <div class="span3">
                 <a href="index.html">
                <img src="images/akkanet.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">Table of contents</li>
                    <li><a href="index.html">Home page</a></li>
                    <li class="divider"></li>
                    
          <ul class="task-list">
<li>
<p>Introduction</p>

<ul class="task-list">
<li><a href="What-is-Akka">What is Akka?</a></li>
<li><a href="Why-Akka">Why Akka?</a></li>
<li><a href="Getting-started">Getting Started</a></li>
<li><a href="The-Obligatory-Hello-World">The Obligatory Hello World</a></li>
<li><a href="Use-case-and-Deployment-Scenarios">Use-case and Deployment Scenarios</a></li>
<li><a href="Examples-of-use-cases-for-Akka">Examples of use-cases for Akka</a></li>
</ul>
</li>
<li>
<p>General</p>

<ul class="task-list">
<li><a href="Terminology">Terminology, Concepts</a></li>
<li><a href="Actor-Systems">Actor Systems</a></li>
<li><a href="Actors">What is an Actor?</a></li>
<li><a href="Supervision">Supervision and Monitoring</a></li>
<li><a href="Addressing">Actor References, Paths and Addresses</a></li>
<li><a href="Remoting">Location Transparency</a></li>
<li>Akka and the Java Memory Model</li>
<li><a href="Message-Delivery-Reliability">Message Delivery Reliability</a></li>
<li><a href="Configuration">Configuration</a></li>
</ul>
</li>
<li>
<p>Actors</p>

<ul class="task-list">
<li><a class="internal present" href="Actors">Actors</a></li>
<li><a class="internal present" href="Untyped-actors">Untyped Actors</a></li>
<li>Typed Actors</li>
<li>Fault Tolerance</li>
<li><a class="internal present" href="Dispatchers">Dispatchers</a></li>
<li>Mailboxes</li>
<li><a class="internal present" href="Routing">Routing</a></li>
<li><a href="FSM">Building Finite State Machine Actors</a></li>
<li>Persistence (Not ported to Akka.NET yet)</li>
<li>Testing Actor Systems</li>
</ul>
</li>
<li>
<p>Networking</p>

<ul class="task-list">
<li>Cluster Specification (Not ported to Akka.NET yet)</li>
<li>Cluster Usage (Not ported to Akka.NET yet)</li>
<li><a class="internal present" href="Remoting">Remoting</a></li>
<li><a class="internal present" href="Serialization">Serialization</a></li>
<li>I/O (Not ported to Akka.NET yet)</li>
<li>Using TCP</li>
<li>Using UDP</li>
</ul>
</li>
<li>
<p>Utilities</p>

<ul class="task-list">
<li><a class="internal present" href="EventBus">EventBus</a></li>
<li><a class="internal present" href="Logging">Logging</a></li>
<li><a class="internal present" href="Scheduler">Scheduler</a></li>
<li><a class="internal present" href="Circuit-Breaker">Circuit Breaker</a></li>
</ul>
</li>
<li>
<p>HowTo: Common Patterns</p>

<ul class="task-list">
<li><a class="internal present" href="Scheduling-Periodic-Messages">Scheduling Periodic Messages</a></li>
<li><a class="internal absent" href="Single-Use-Actor-Trees-with-High-Level-Error-Reporting">Single-Use Actor Trees with High-Level Error Reporting</a></li>
</ul>
</li>
<li>
<p>Experimental Modules</p>

<ul class="task-list">
<li>
<a class="internal absent" href="Persistence">Persistence</a>(Not ported to Akka.NET yet)</li>
<li><a class="internal absent" href="Multi-Node-Testing">Multi Node Testing</a></li>
</ul>
</li>
<li>
<p>Information for Akka Developers</p>

<ul class="task-list">
<li><a class="internal present" href="Building-and-Distributing-Akka.NET">Building and Distributing Akka.NET</a></li>
<li><a class="internal present" href="Developer-Guidelines">Developer Guidelines</a></li>
<li><a class="internal absent" href="Documentation-Guidelines">Documentation Guidelines</a></li>
<li><a class="internal present" href="Team">Team</a></li>
</ul>
</li>
<li>
<p>Project Information</p>

<ul class="task-list">
<li><a href="https://github.com/akkadotnet/akka.net/issues?state=open">Issue Tracking</a></li>
<li><a class="internal present" href="Licenses">Licenses</a></li>
<li><a class="internal present" href="Sponsors">Sponsors</a></li>
<li><a class="internal present" href="Project">Project</a></li>
</ul>
</li>
<li>
<p>Additional Information</p>

<ul class="task-list">
<li><a class="internal present" href="Frequently-Asked-Questions">Frequently Asked Questions</a></li>
<li><a class="internal present" href="Books">Books</a></li>
</ul>
</li>
</ul>
        
                </ul>
            </div>
        </div>
    </div>
    <a href="https://github.com/akkadotnet/Akka.NET"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
</body>
</html>