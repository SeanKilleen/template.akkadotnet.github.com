
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <!--
         The FAKE - F# Make - A DSL for build tasks
    parameters will be replaced with the
         document title extracted from the <h1> element or
         file name, if there is no <h1> heading
       -->
    <title>
        Akka.NET
    </title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Akka.NET">
    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet">
    <link type="text/css" rel="stylesheet" href="content/style.css" />
    <script src="content/tips.js" type="text/javascript"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
</head>
<body>
    <div class="container">
        <div class="masthead">
            <ul class="nav nav-pills pull-right">
                <li><a href="https://github.com/akkadotnet/">github page</a></li>
            </ul>
            <h3 class="muted">Akka.NET</h3>
        </div>
        <hr />
        <div class="row">
            <div class="span9" id="main">
                
      <p>An Akka <code>MessageDispatcher</code> is what makes Akka Actors "tick", it is the engine of the machine so to speak. All <code>MessageDispatcher</code> implementations are also an <code>ExecutionContext</code>, which means that they can be used to execute arbitrary code, for instance <code>Futures</code>.</p>

<h2>
<a name="user-content-default-dispatcher" class="anchor" href="#default-dispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Default dispatcher</h2>

<p>Every <code>ActorSystem</code> will have a default dispatcher that will be used in case nothing else is configured for an Actor. The default dispatcher can be configured, and is by default a <code>Dispatcher</code> with the specified <code>default-executor</code>. If an <code>ActorSystem</code> is created with an <code>ExecutionContext</code> passed in, this <code>ExecutionContext</code> will be used as the default executor for all dispatchers in this <code>ActorSystem</code>. If no <code>ExecutionContext</code> is given, it will fallback to the executor specified in <code>akka.actor.default-dispatcher.default-executor.fallback</code>. By default this is a <code>"fork-join-executor"</code>, which gives excellent performance in most cases.</p>

<h4>
<a name="user-content-actors-multiplexing-on-net-thread-pool" class="anchor" href="#actors-multiplexing-on-net-thread-pool" aria-hidden="true"><span class="octicon octicon-link"></span></a>Actors multiplexing on .NET thread pool</h4>

<p><img src="images/ThreadMultiplex.png"></p>

<h2>
<a name="user-content-looking-up-a-dispatcher" class="anchor" href="#looking-up-a-dispatcher" aria-hidden="true"><span class="octicon octicon-link"></span></a>Looking up a Dispatcher</h2>

<p>Dispatchers implement the ExecutionContext interface and can thus be used to run Future invocations etc.</p>

<div class="highlight highlight-csharp"><pre><span class="c1">// this is scala.concurrent.ExecutionContext</span>
<span class="c1">// for use with Futures, Scheduler, etc.</span>
<span class="n">ExecutionContext</span> <span class="n">ex</span> <span class="p">=</span> <span class="n">system</span><span class="p">.</span><span class="n">Dispatchers</span><span class="p">.</span><span class="n">Lookup</span><span class="p">(</span><span class="s">"my-dispatcher"</span><span class="p">);</span>
</pre></div>

<h2>
<a name="user-content-setting-the-dispatcher-for-an-actor" class="anchor" href="#setting-the-dispatcher-for-an-actor" aria-hidden="true"><span class="octicon octicon-link"></span></a>Setting the dispatcher for an Actor</h2>

<p>So in case you want to give your Actor a different dispatcher than the default, you need to do two things, of which the first is is to configure the dispatcher:</p>

<pre><code>my-dispatcher {
  # Dispatcher is the name of the event-based dispatcher
  type = Dispatcher
  # What kind of ExecutionService to use
  executor = "fork-join-executor"
  # Configuration for the fork join pool
  fork-join-executor {
    # Min number of threads to cap factor-based parallelism number to
    parallelism-min = 2
    # Parallelism (threads) ... ceil(available processors * factor)
    parallelism-factor = 2.0
    # Max number of threads to cap factor-based parallelism number to
    parallelism-max = 10
  }
  # Throughput defines the maximum number of messages to be
  # processed per actor before the thread jumps to the next actor.
  # Set to 1 for as fair as possible.
  throughput = 100
}
</code></pre>

<p>And here's another example that uses the <code>"thread-pool-executor"</code>:</p>

<pre><code>my-thread-pool-dispatcher {
  # Dispatcher is the name of the event-based dispatcher
  type = Dispatcher
  # What kind of ExecutionService to use
  executor = "thread-pool-executor"
  # Configuration for the thread pool
  thread-pool-executor {
    # minimum number of threads to cap factor-based core number to
    core-pool-size-min = 2
    # No of core threads ... ceil(available processors * factor)
    core-pool-size-factor = 2.0
    # maximum number of threads to cap factor-based number to
    core-pool-size-max = 10
  }
  # Throughput defines the maximum number of messages to be
  # processed per actor before the thread jumps to the next actor.
  # Set to 1 for as fair as possible.
  throughput = 100
}
</code></pre>

<p>For more options, see the <code>default-dispatcher</code> section of the Configuration.</p>

<p>Then you create the actor as usual and define the dispatcher in the deployment configuration.</p>

<pre lang="chsarp"><code>ActorRef myActor =
  system.ActorOf(Props.Create(typeof(MyUntypedActor)),
    "myactor");
</code></pre>

<pre><code>akka.actor.deployment {
  /myactor {
    dispatcher = my-dispatcher
  }
}
</code></pre>

<p>An alternative to the deployment configuration is to define the dispatcher in code. If you define the dispatcher in the deployment configuration then this value will be used instead of programmatically provided parameter.</p>

<div class="highlight highlight-csharp"><pre><span class="n">ActorRef</span> <span class="n">myActor</span> <span class="p">=</span>
  <span class="n">system</span><span class="p">.</span><span class="n">ActorOf</span><span class="p">(</span><span class="n">Props</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyUntypedActor</span><span class="p">)).</span><span class="n">WithDispatcher</span><span class="p">(</span><span class="s">"my-dispatcher"</span><span class="p">),</span>
    <span class="s">"myactor3"</span><span class="p">);</span>
</pre></div>

<blockquote>
<p><strong>Note</strong><br>
The dispatcher you specify in withDispatcher and the dispatcher property in the deployment configuration is in fact a path into your configuration. So in this example it's a top-level section, but you could for instance put it as a sub-section, where you'd use periods to denote sub-sections, like this: "foo.bar.my-dispatcher"</p>
</blockquote>

<h2>
<a name="user-content-types-of-dispatchers" class="anchor" href="#types-of-dispatchers" aria-hidden="true"><span class="octicon octicon-link"></span></a>Types of dispatchers</h2>

<p>There are 4 different types of message dispatchers:</p>

<ul class="task-list">
<li>
<p>Dispatcher</p>

<ul class="task-list">
<li>This is an event-based dispatcher that binds a set of Actors to a thread pool. It is the default dispatcher used if one is not specified.</li>
<li>Sharability: Unlimited</li>
<li>Mailboxes: Any, creates one per Actor</li>
<li>Use cases: Default dispatcher, Bulkheading</li>
<li>Driven by: java.util.concurrent.ExecutorService
specify using "executor" using "fork-join-executor", "thread-pool-executor" or the FQCN of an akka.dispatcher.ExecutorServiceConfigurator</li>
</ul>
</li>
<li>
<p>PinnedDispatcher</p>

<ul class="task-list">
<li>This dispatcher dedicates a unique thread for each actor using it; i.e. each actor will have its own thread pool with only one thread in the pool.</li>
<li>Sharability: None</li>
<li>Mailboxes: Any, creates one per Actor</li>
<li>Use cases: Bulkheading</li>
<li>Driven by: Any <code>Akka.Dispatch.ThreadPoolExecutorConfigurator</code>
by default a "thread-pool-executor"</li>
</ul>
</li>
<li>
<p>CallingThreadDispatcher</p>

<ul class="task-list">
<li>This dispatcher runs invocations on the current thread only. This dispatcher does not create any new threads, but it can be used from different threads concurrently for the same actor. See CallingThreadDispatcher for details and restrictions.</li>
<li>Sharability: Unlimited</li>
<li>Mailboxes: Any, creates one per Actor per Thread (on demand)</li>
<li>Use cases: Testing</li>
<li>Driven by: The calling thread (duh)</li>
</ul>
</li>
</ul><h3>
<a name="user-content-more-dispatcher-configuration-examples" class="anchor" href="#more-dispatcher-configuration-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>More dispatcher configuration examples</h3>

<p>Configuring a <code>PinnedDispatcher</code>:</p>

<pre><code>my-pinned-dispatcher {
  executor = "thread-pool-executor"
  type = PinnedDispatcher
}
</code></pre>

<p>And then using it:</p>

<div class="highlight highlight-csharp"><pre><span class="n">ActorRef</span> <span class="n">myActor</span> <span class="p">=</span> <span class="n">system</span><span class="p">.</span><span class="n">ActorOf</span><span class="p">(</span><span class="n">Props</span><span class="p">.</span><span class="n">Create</span><span class="p">(</span><span class="k">typeof</span><span class="p">(</span><span class="n">MyUntypedActor</span><span class="p">));</span>
    <span class="p">.</span><span class="n">WithDispatcher</span><span class="p">(</span><span class="s">"my-pinned-dispatcher"</span><span class="p">));</span>
</pre></div>

<p>Note that <code>thread-pool-executor</code> configuration as per the above <code>my-thread-pool-dispatcher</code> example is NOT applicable. This is because every actor will have its own thread pool when using PinnedDispatcher, and that pool will have only one thread.</p>

<p>Note that it's not guaranteed that the same thread is used over time, since the core pool timeout is used for <code>PinnedDispatcher</code> to keep resource usage down in case of idle actors. To use the same thread all the time you need to add <code>thread-pool-executor.allow-core-timeout=off</code> to the configuration of the <code>PinnedDispatcher</code>.</p>
    
            </div>
            <div class="span3">
                 <a href="index.html">
                <img src="images/akkanet.png" style="width:140px;height:140px;margin:10px 0px 0px 35px;border-style:none;" />
                </a>
                <ul class="nav nav-list" id="menu">
                    <li class="nav-header">Table of contents</li>
                    <li><a href="index.html">Home page</a></li>
                    <li class="divider"></li>
                    
          <ul class="task-list">
<li>
<p>Introduction</p>

<ul class="task-list">
<li><a href="What-is-Akka">What is Akka?</a></li>
<li><a href="Why-Akka">Why Akka?</a></li>
<li><a href="Getting-started">Getting Started</a></li>
<li><a href="The-Obligatory-Hello-World">The Obligatory Hello World</a></li>
<li><a href="Use-case-and-Deployment-Scenarios">Use-case and Deployment Scenarios</a></li>
<li><a href="Examples-of-use-cases-for-Akka">Examples of use-cases for Akka</a></li>
</ul>
</li>
<li>
<p>General</p>

<ul class="task-list">
<li><a href="Terminology">Terminology, Concepts</a></li>
<li><a href="Actor-Systems">Actor Systems</a></li>
<li><a href="Actors">What is an Actor?</a></li>
<li><a href="Supervision">Supervision and Monitoring</a></li>
<li><a href="Addressing">Actor References, Paths and Addresses</a></li>
<li><a href="Remoting">Location Transparency</a></li>
<li>Akka and the Java Memory Model</li>
<li><a href="Message-Delivery-Reliability">Message Delivery Reliability</a></li>
<li><a href="Configuration">Configuration</a></li>
</ul>
</li>
<li>
<p>Actors</p>

<ul class="task-list">
<li><a class="internal present" href="Actors">Actors</a></li>
<li><a class="internal present" href="Untyped-actors">Untyped Actors</a></li>
<li>Typed Actors</li>
<li>Fault Tolerance</li>
<li><a class="internal present" href="Dispatchers">Dispatchers</a></li>
<li>Mailboxes</li>
<li><a class="internal present" href="Routing">Routing</a></li>
<li><a href="FSM">Building Finite State Machine Actors</a></li>
<li>Persistence (Not ported to Akka.NET yet)</li>
<li>Testing Actor Systems</li>
</ul>
</li>
<li>
<p>Networking</p>

<ul class="task-list">
<li>Cluster Specification (Not ported to Akka.NET yet)</li>
<li>Cluster Usage (Not ported to Akka.NET yet)</li>
<li><a class="internal present" href="Remoting">Remoting</a></li>
<li><a class="internal present" href="Serialization">Serialization</a></li>
<li>I/O (Not ported to Akka.NET yet)</li>
<li>Using TCP</li>
<li>Using UDP</li>
</ul>
</li>
<li>
<p>Utilities</p>

<ul class="task-list">
<li><a class="internal present" href="EventBus">EventBus</a></li>
<li><a class="internal present" href="Logging">Logging</a></li>
<li><a class="internal present" href="Scheduler">Scheduler</a></li>
<li><a class="internal present" href="Circuit-Breaker">Circuit Breaker</a></li>
</ul>
</li>
<li>
<p>HowTo: Common Patterns</p>

<ul class="task-list">
<li><a class="internal present" href="Scheduling-Periodic-Messages">Scheduling Periodic Messages</a></li>
<li><a class="internal absent" href="Single-Use-Actor-Trees-with-High-Level-Error-Reporting">Single-Use Actor Trees with High-Level Error Reporting</a></li>
</ul>
</li>
<li>
<p>Experimental Modules</p>

<ul class="task-list">
<li>
<a class="internal absent" href="Persistence">Persistence</a>(Not ported to Akka.NET yet)</li>
<li><a class="internal absent" href="Multi-Node-Testing">Multi Node Testing</a></li>
</ul>
</li>
<li>
<p>Information for Akka Developers</p>

<ul class="task-list">
<li><a class="internal present" href="Building-and-Distributing-Akka.NET">Building and Distributing Akka.NET</a></li>
<li><a class="internal present" href="Developer-Guidelines">Developer Guidelines</a></li>
<li><a class="internal absent" href="Documentation-Guidelines">Documentation Guidelines</a></li>
<li><a class="internal present" href="Team">Team</a></li>
</ul>
</li>
<li>
<p>Project Information</p>

<ul class="task-list">
<li><a href="https://github.com/akkadotnet/akka.net/issues?state=open">Issue Tracking</a></li>
<li><a class="internal present" href="Licenses">Licenses</a></li>
<li><a class="internal present" href="Sponsors">Sponsors</a></li>
<li><a class="internal present" href="Project">Project</a></li>
</ul>
</li>
<li>
<p>Additional Information</p>

<ul class="task-list">
<li><a class="internal present" href="Frequently-Asked-Questions">Frequently Asked Questions</a></li>
<li><a class="internal present" href="Books">Books</a></li>
</ul>
</li>
</ul>
        
                </ul>
            </div>
        </div>
    </div>
    <a href="https://github.com/akkadotnet/Akka.NET"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png" alt="Fork me on GitHub"></a>
</body>
</html>